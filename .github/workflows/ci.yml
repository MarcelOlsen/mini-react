name: ğŸ§ª Continuous Integration

on:
  push:
    branches-ignore: [master]
  pull_request:
    branches: [master]

jobs:
  test:
    name: ğŸ§ª Test Suite
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: ğŸ“¦ Install dependencies
        run: bun install

      - name: ğŸ§ª Run tests
        run: bun test

      - name: ğŸ” Lint and format check
        run: bun run check

      - name: ğŸ—ï¸ Test build
        run: bun run build

      - name: ğŸ“ Check bundle size
        run: |
          BUNDLE_SIZE=$(du -sh dist/ | cut -f1)
          echo "ğŸ“¦ Bundle size: $BUNDLE_SIZE"
          echo "bundle-size=$BUNDLE_SIZE" >> $GITHUB_OUTPUT

  security:
    name: ğŸ”’ Security Audit
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Bun
        uses: oven-sh/setup-bun@v1

      - name: ğŸ“¦ Install dependencies
        run: bun install

      - name: ğŸ”’ Security audit
        run: bun audit || echo "âš ï¸ Security audit completed with warnings"

  compatibility:
    name: ğŸŒ Compatibility Test
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Setup Bun
        uses: oven-sh/setup-bun@v1

      - name: ğŸ“¦ Install dependencies
        run: bun install

      - name: ğŸ—ï¸ Build package
        run: bun run build

      - name: ğŸ§ª Test package installation
        run: |
          # Test local package installation
          npm pack
          PACKAGE=$(ls *.tgz)
          mkdir test-install && cd test-install
          npm init -y
          npm install ../$PACKAGE
          echo "âœ… Package installation test passed"
